<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="架构,设计,函数式,">





  <link rel="alternate" href="/atom.xml" title="雪峰的blog" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2">






<meta name="description" content="函数式编程中有很多优秀的设计理念值得我们去学习，本文对函数式编程中的基础理念进行了简要的介绍，但更重要的是思考、总结如何将它们应用到我们日常开发中，帮助我们去提升代码的可读性、可维护性等。">
<meta name="keywords" content="架构,设计,函数式">
<meta property="og:type" content="article">
<meta property="og:title" content="函数式思维">
<meta property="og:url" content="http://zxfcumtcs.github.io/2019/11/17/functional/index.html">
<meta property="og:site_name" content="雪峰的blog">
<meta property="og:description" content="函数式编程中有很多优秀的设计理念值得我们去学习，本文对函数式编程中的基础理念进行了简要的介绍，但更重要的是思考、总结如何将它们应用到我们日常开发中，帮助我们去提升代码的可读性、可维护性等。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://zxfcumtcs.github.io/img/reduce.png">
<meta property="og:image" content="http://zxfcumtcs.github.io/img/fold.png">
<meta property="og:image" content="http://zxfcumtcs.github.io/img/stackusericon.jpeg">
<meta property="og:image" content="http://zxfcumtcs.github.io/img/pipe.png">
<meta property="og:updated_time" content="2019-11-24T09:23:40.887Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="函数式思维">
<meta name="twitter:description" content="函数式编程中有很多优秀的设计理念值得我们去学习，本文对函数式编程中的基础理念进行了简要的介绍，但更重要的是思考、总结如何将它们应用到我们日常开发中，帮助我们去提升代码的可读性、可维护性等。">
<meta name="twitter:image" content="http://zxfcumtcs.github.io/img/reduce.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zxfcumtcs.github.io/2019/11/17/functional/">





  <title>函数式思维 | 雪峰的blog</title>
  














</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">雪峰的blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">善于总结, 乐于分享</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://zxfcumtcs.github.io/2019/11/17/functional/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="赵雪峰">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/author.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="雪峰的blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">函数式思维</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-17T22:04:04+08:00">
                2019-11-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2019/11/17/functional/" class="leancloud_visitors" data-flag-title="函数式思维">
               
             </span>
          
          

          

          
            <div class="post-wordcount">
              
                
                  <span class="post-meta-divider">|</span>
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  4,829
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  18
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>函数式编程中有很多优秀的设计理念值得我们去学习，本文对函数式编程中的基础理念进行了简要的介绍，但更重要的是思考、总结如何将它们应用到我们日常开发中，帮助我们去提升代码的可读性、可维护性等。<br><a id="more"></a><br>©原创文章，转载请注明出处！</p>
<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><hr>
<p>对函数式编程一直有所耳闻，但并未深入研究过，在日常开发中也很少去思考这方面的问题。<br>直到最近，在开发 flutter 应用时，由于 dart 对函数式编程有较好地支持，对函数式编程有了更新的认识。<br>纯函数式的编程对我们正常的业务开发来说是一种『乌托邦』式的存在，但其中有很多的设计理念值得我们去学习。<br>函数式编程相关的文章也有不少，本文的不同之处在于其立足点是：<br>如何利用函数式编程理念帮助我们写出更好的代码，这也是本文标题叫做函数式思维而不是函数式编程的原因。</p>
<blockquote>
<p>函数式编程的理论基础是<code>λ</code>演算(lambda calculus)，但本文并不打算在理论层面上做过多的讨论。</p>
</blockquote>
<p>首先，总结一下我个人的观点：函数式编程能给我们带来什么？<br>简单、清晰、易维护、可复用的代码。</p>
<blockquote>
<p>简单、清晰、易维护、可复用可以说是各种架构设计、设计规范追求的第一目标。</p>
</blockquote>
<p>那函数式编程又是通过什么方式实现这样的收益的：</p>
<ul>
<li>状态不可变、纯函数；</li>
<li>避免引入状态，Pointfree；</li>
<li>强调组合、提高复用性；</li>
<li>更高层次的抽象，丰富的集合操作。</li>
</ul>
<p>本文将主要围绕以上几方面对函数式编程展开讨论。</p>
<h1 id="Functional-vs-Imperative"><a href="#Functional-vs-Imperative" class="headerlink" title="Functional vs. Imperative"></a>Functional vs. Imperative</h1><hr>
<p>函数式编程作为编程范式(Programming Paradigm)之一，与之对应的，也是我们最熟悉的命令式编程(Imperative programming，面向对象编程也属于该范式)。</p>
<p>从思维模式上说：</p>
<ul>
<li>命令式编程：『过程导向』，<strong>强调怎么做</strong>——关注点在执行步骤，如何一步一步地去完成任务；</li>
<li>函数式编程：『结果导向』，<strong>强调做什么</strong>——关注点在执行结果，相比属于更高层次的抽象，并不关心实现细节。</li>
</ul>
<p>从理论依据上说：</p>
<ul>
<li>命令式编程：面向计算机的模型，变量、赋值、控制语句等分别对应计算机的物理存储、读写指令、跳转指令；</li>
<li>函数式编程：面向数学的模型，将任务以表达式求值的形式表现。</li>
</ul>
<p>从实现手法上说：<br>函数式编程是对命令式编程进一步的抽象，屏蔽具体细节，以更加抽象、更加接近自然语言的方式去描述程序的意图，将实现细节交由语言运行时或三方扩展去完成。<br>从而，开发人员可以从实现细节中解脱出来，站在更高的抽象层次上去思考业务问题。</p>
<h2 id="现状"><a href="#现状" class="headerlink" title="现状"></a>现状</h2><p>纯函数、高阶函数、函数一等公民身份、集合操作三板斧等理念极大地提高了语言的创造力、表现力。<br>虽然无法做到纯函数式，但越来越多的高级语言开始向函数式方向发展，将函数式中的若干重要理念引入自身语法中，如：JavaScript、Swift、Java、dart 等。</p>
<h1 id="纯函数"><a href="#纯函数" class="headerlink" title="纯函数"></a>纯函数</h1><hr>
<p>函数式编程中的『函数』并非我们日常开发中所说的函数(方法)，而是数学意义上的函数——映射。<br>我们知道数学上函数(映射)对相同的输入必定有相同的输出(映射关系是一一对应的)。<br>因此，函数式编程中纯函数也要满足同样的特征：</p>
<ul>
<li>相同的输入，必定得到相同的输出；</li>
<li>函数调用没有任何副作用。</li>
</ul>
<h2 id="相同的输入，相同的输出"><a href="#相同的输入，相同的输出" class="headerlink" title="相同的输入，相同的输出"></a>相同的输入，相同的输出</h2><p>要满足这一点，意味着函数不能依赖除入参以外的任何外部状态。<br>面向对象中类的成员函数隐式地包含<code>this</code>指针，通过它可以很方便地在成员函数中引用成员变量，这就是纯函数的典型反面教材。</p>
<p>为什么？<br>实现了函数级的解耦，除了入参没有复杂的依赖关系，这样的函数可读性、可维护性就变得很高。<br>相信大家在平常开发中，也能有这样的感受：<br>在理解、维护一个函数时，若其依赖了大量的外部状态，必定会造成不小的认知压力。<br>除了要理解函数本身的逻辑外，还要去关心其引用的外部状态信息。<br>有时不得不跳出函数本身去查看这些依赖的外部信息，阅读流程也因此被打断。</p>
<h2 id="无副作用"><a href="#无副作用" class="headerlink" title="无副作用"></a>无副作用</h2><p>副作用是指除期望的函数输出值外的任何产出。</p>
<p>常见的副作用包括，但不限于：</p>
<ul>
<li>改变外部数据(如类的成员变量、全局变量)；</li>
<li>发送网络请求；</li>
<li>读写文件；</li>
<li>执行DB操作；</li>
<li>获取用户交互信息(用户输入)；</li>
<li>读取系统状态信息；</li>
<li>打日志；</li>
<li>…</li>
</ul>
<p>总之，纯函数就是不能与外部有任何的耦合关系，包括对外界的依赖以及对外界的影响。</p>
<p>很明显，纯函数的收益主要有：</p>
<ul>
<li>可维护性更高；</li>
<li>可测性更强；</li>
<li>可复用性更好；</li>
<li>高并发更容易，没有多线程问题；</li>
<li>可缓存，由于相同的输入，必定有相同的输出，因此对于高频、昂贵的操作可以缓存结果，避免重复计算。</li>
</ul>
<p>在实际开发中，虽然无法做到所有函数都是纯函数，但纯函数意识应该要深植我们脑海中，尽可能地写更多的纯函数。</p>
<h1 id="高阶函数-Higher-order-function"><a href="#高阶函数-Higher-order-function" class="headerlink" title="高阶函数(Higher-order function)"></a>高阶函数(Higher-order function)</h1><hr>
<p>函数式编程还有一个重要理念：<strong>函数是值</strong>，即一等函数(first-class)，或者说函数有一等公民身份。<br>这意味着任何可以使用值的地方都可以使用函数，如参数、返回值等。</p>
<p>所谓高阶函数就是其参数或返回值至少有一个是函数类型。<br>高阶函数使得复用粒度降到了函数级别，在面向对象中复用粒度一般在类级别。</p>
<blockquote>
<p>闭包(closure)是高阶函数得以实现的底层支撑能力。</p>
</blockquote>
<p>从另一个角度讲，高阶函数也实现了更高层级的抽象，因为实现细节可以通过参数的形式传入，即在函数级别上实现了依赖注入机制。因此，多种GoF设计模式可以通过高阶函数的形式来实现，如：Template Method模式、Strategy模式等。</p>
<h1 id="柯里化-Currying"><a href="#柯里化-Currying" class="headerlink" title="柯里化(Currying)"></a>柯里化(Currying)</h1><hr>
<p>简单讲，柯里化就是将『多参数函数』转换成『一系列单参数函数』的过程。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> addCurrying = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如上，<code>add</code>是进行加法运算的函数，其接收2个参数，如<code>add(1, 2)</code>。<br>而<code>addCurrying</code>是经过柯里化处理过的，本质上<code>addCurrying</code>是单参数函数，其返回值也是一个单参数函数。<br><code>add(1, 2)</code>，等价于<code>addCurrying(1)(2)</code>。</p>
<p>柯里化有什么作用？</p>
<ul>
<li>在函数式集合操作上，如：<code>filter</code>、<code>map</code>、<code>reduce</code>、<code>expand</code>等只接收单参数函数，因此如果现有的函数是多参数，可通过柯里化转换成单参数；</li>
<li>当某个函数需要多次调用，且部分参数相同时，通过柯里化可以减少重复参数样板代码。</li>
</ul>
<p>如，有多次调用加法运算的需求，且每次都是加<code>10</code>时，用普通<code>add</code>函数实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(10, 1);</span><br><span class="line">add(10, 2);</span><br><span class="line">add(10, 3);</span><br></pre></td></tr></table></figure></p>
<p>而通过柯里化的版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var addTen = addCurrying(10);</span><br><span class="line">addTen(1);</span><br><span class="line">addTen(2);</span><br><span class="line">addTen(3);</span><br></pre></td></tr></table></figure></p>
<p>著名的 JavaScript 三方库<code>lodash</code>提供了<code>curry</code>封装函数，使得柯里化更加方便，如上面的<code>addCurrying</code>用<code>lodash#curry</code>函数实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var curry = require(&apos;lodash&apos;).curry;</span><br><span class="line">var addCurrying = curry(function(a, b) &#123;</span><br><span class="line">  return a + b;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>对函数式编程来说，柯里化是一项不可或缺的技能。<br>对我们而言，即使不写函数式的代码，在解决重复参数等问题上柯里化也提供了一种全新的思路。</p>
<h1 id="集合操作三板斧"><a href="#集合操作三板斧" class="headerlink" title="集合操作三板斧"></a>集合操作三板斧</h1><hr>
<blockquote>
<p>函数式编程语言和面向对象语言对待代码重用的方式不一样。面向对象语言喜欢大量地建立有很多操作的各种数据结构，函数式语言也有很多的操作，但对应的数据结构却很少。面向对象语言鼓励我们建立专门针对某个类的方法，我们从类的关系中发现重复出现的模式并加以重用。函数式语言的重用表现在函数的通用性上，它们鼓励在数据结构上使用各种共通的变换，并通过高阶函数来调整操作以满足具体事项的要求。</p>
</blockquote>
<blockquote>
<p>在面向对象的命令式编程语言里面，重用的单元是类和用作类间通信的消息，通常可以表述成一幅类图(class diagram)。例如这个领域的开拓性著作《设计模式：可复用面向对象软件的基础》就给每一个模式都至少绘制了一幅类图。在OOP的世界里，开发者被鼓励针对具体的问题建立专门的数据结构，并以方法的形式，将专门的操作关联在数据结构上。函数式编程语言选择了另一种重用思路。它们用很少的一组关键数据结构(如list 、set 、map)来搭配专为这些数据结构深度优化过的操作。我们在这些关键数据结构和操作组成的一套运转机构上面，按需要“插入”另外的数据结构和高阶函数来调整机器，以适应具体的问题。例如我们已经在几种语言中操练过的filter函数，传给它的代码块就是这么一个“插入”的部件，筛选的条件由传入的高阶函数确定，而运转机构则负责高效率地实施筛选，并返回筛选后的列表。<br>——<a href="https://book.douban.com/subject/26587213/" target="_blank" rel="noopener">摘录来自: [美] 福特（Neal Ford）. “函数式编程思维 (图灵程序设计丛书)。”</a></p>
</blockquote>
<p>正如上述摘录所说，函数式编程的又一重要理念：<strong>在有限的集合(Collection)上提供丰富的操作</strong>。<br>现在，很多高级语言都提供了大量对集合操作的支持，如Swift、Java 8、JavaScript、dart等。<br>通过这些高度抽象的操作，可以写出非常简洁、易读的代码。</p>
<p>下面对一些常见集合操作作一个简要介绍。</p>
<h2 id="过滤-filter"><a href="#过滤-filter" class="headerlink" title="过滤(filter)"></a>过滤(filter)</h2><p>过滤就是将列表中不满足指定条件的元素过滤掉，满足条件的元素以新列表的形式返回。<br>在不同的语言中，该操作的名称有所不同：JavaScript、Swift、Java 8中是<code>filter</code>，dart是<code>where</code>。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">filter(callback(element[, index[, array]])[, thisArg]);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dart</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="built_in">Iterable</span>&lt;E&gt; where(<span class="built_in">bool</span> test(E element));</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Swift</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">filter</span><span class="params">(<span class="number">_</span> isIncluded: <span class="params">(<span class="keyword">Self</span>.Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Bool</span>) <span class="keyword">rethrows</span> -&gt; [<span class="type">Self</span>.<span class="type">Element</span>];</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function">Stream&lt;T&gt; <span class="title">filter</span><span class="params">(Predicate&lt;? <span class="keyword">super</span> T&gt; predicate)</span></span>;</span><br></pre></td></tr></table></figure>
<p>可以看到，各语言表现形式上虽有所不同，但本质是一样的，即为<code>filter</code>注入一个回调，用于判断其中的元素是否满足指定条件。</p>
<p>如下例，将年龄未满18的过滤掉：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">const</span> ages = [<span class="number">19</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">30</span>, <span class="number">11</span>, <span class="number">18</span>];</span><br><span class="line"><span class="keyword">const</span> result = ages.filter(<span class="function"><span class="params">age</span> =&gt;</span> age &gt;= <span class="number">18</span>);</span><br><span class="line"><span class="built_in">console</span>.log(result);    <span class="comment">// 19, 30, 18</span></span><br></pre></td></tr></table></figure></p>
<p>通过循环语句实现就不在这列了，两者的对比应该是很明显的。</p>
<h2 id="映射-map"><a href="#映射-map" class="headerlink" title="映射(map)"></a>映射(map)</h2><p>map就是将集合中的每个元素进行一次转换，得到一个新的值，其类型可以相同也可以不同。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">map(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">currentValue[, index[, array]]</span>);</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dart</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="built_in">Iterable</span>&lt;T&gt; map&lt;T&gt;(T f(E e));</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Swift</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">map</span>&lt;T&gt;<span class="params">(<span class="number">_</span> transform: <span class="params">(Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">T</span>) <span class="keyword">rethrows</span> -&gt; [<span class="type">T</span>];</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&lt;R&gt; <span class="function">Stream&lt;R&gt; <span class="title">map</span><span class="params">(Function&lt;? <span class="keyword">super</span> T,? extends R&gt; mapper)</span></span>;</span><br></pre></td></tr></table></figure>
<p>map是日常开发中使用频率最高的操作之一，如将json转换成dart对象实例：<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jsons.map((json) =&gt; BusinessModel.fromJson(json)).toList();</span><br></pre></td></tr></table></figure></p>
<h2 id="折叠-化约-reduce、fold"><a href="#折叠-化约-reduce、fold" class="headerlink" title="折叠/化约(reduce、fold)"></a>折叠/化约(reduce、fold)</h2><p>折叠简单讲就是将指定操作依次作用于集合每个元素上，操作结果按操作规则依次叠加，并最终返回该叠加结果(结果类型一般是一个具体的值，而不是Iterable，因此经常出现在链式调用的末端。)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">reduce(callback(accumulator, currentValue[, index[, array]])[, initialValue]);</span><br></pre></td></tr></table></figure>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dart</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">E reduce(E combine(E value, E element))</span><br><span class="line">T fold&lt;T&gt;(T initialValue, T combine(T previousValue, E element));</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Swift</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reduce</span>&lt;Result&gt;<span class="params">(<span class="number">_</span> initialResult: Result, <span class="number">_</span> nextPartialResult: <span class="params">(Result, Element)</span></span></span> <span class="keyword">throws</span> -&gt; <span class="type">Result</span>) <span class="keyword">rethrows</span> -&gt; <span class="type">Result</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function">T <span class="title">reduce</span><span class="params">(T identity, BinaryOperator&lt;T&gt; accumulator)</span></span>;</span><br></pre></td></tr></table></figure>
<p>其中，dart提供了两个操作方法<code>reduce</code>、<code>fold</code>，主要区别在于后者可以提供折叠时的初始值。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; nums = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>,];</span><br><span class="line"><span class="comment">// reduceResult: 25</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="built_in">int</span> reduceResult = nums.reduce((value, elemnt) =&gt; value + elemnt);</span><br><span class="line"></span><br><span class="line"><span class="comment">// foldResult: 35</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="built_in">int</span> foldResult = nums.fold(<span class="number">10</span>, (value, elemnt) =&gt; value + elemnt);</span><br></pre></td></tr></table></figure>
<p>如上例，<code>reduce</code>是直接对列表元素求和(结果是25)，而<code>fold</code>在求和时提供了初始值10(结果是35).</p>
<p><img src="/img/reduce.png" alt=""><br><img src="/img/fold.png" alt=""><br>以上<code>reduce</code>、<code>fold</code>都是从左往右进行折叠，有的语言还提供了从右往左折叠的版本，如JavaScript:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reduceRight(callback(accumulator, currentValue[, index[, array]])[, initialValue])</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>集合操作还有很多，在此不一一列举。当开始使用这些操作后，会惊奇地发现根本停不下来！</p>
</blockquote>
<p>集合上的操作还有一个重要特性：<strong>不可变性(immutable)</strong>，即这些操作不会改变它们正在作用的集合，而是生成新集合来提供操作结果。</p>
<blockquote>
<p>有很多的模式或框架都有类似的思想，如：flux、redux、bloc等，它们都强调(强制)任何操作都不能直接修改现有数据，而是在现有数据的基础上生成新数据，最终整体替换掉老数据。</p>
</blockquote>
<blockquote>
<p>在实际开发中我们也遇到过类似的问题，网络请求在子线程返回数据后直接修改了数据源，导致出现数据不同步的多线程问题。最好的解决方案是网络请求返回后在子线程组装好完整的数据，再到主线程进行一次性替换。</p>
</blockquote>
<p>不可变性很好地避免了中间状态、状态不同步等问题，也较好地规避了多线程问题。<br>同时，不变性语义使得代码可读性、维护推理性变得更好。</p>
<p>因为，通过<code>filter</code>、<code>map</code>、<code>reduce</code>等操作，而不是<code>for</code>、<code>while</code>循环语句操作集合，可以清楚地表达将会生成一个新集合，而不是修改现有集合的意图，代码更加简洁明了。</p>
<p>另外，由于集合上的这些操作的返回值类型大都是集合，因此，当有多个操作作用于集合时，就可以以链式调用的方式实现。这也进一步简化了代码。<br>看一个 flutter 的例子：<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imperative flutter</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">memberIconURLs</span><br><span class="line">  .where(_isValidURL)</span><br><span class="line">  .take(<span class="number">4</span>)</span><br><span class="line">  .map(_memberWidgetBuilder)</span><br><span class="line">  .fold(stack, _addMemberWidget2Stack);</span><br></pre></td></tr></table></figure></p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// functional flutter</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="built_in">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">String</span> url <span class="keyword">in</span> memberIconURLs) &#123;</span><br><span class="line">  <span class="keyword">if</span> (_isValidURL(url)) &#123;</span><br><span class="line">    Widget memberWidget = _memberWidgetBuilder(url);</span><br><span class="line">    _addMemberWidget2Stack(stack, memberWidget);</span><br><span class="line">    count++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (count &gt;= <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面两个代码片段分别用函数式集合操作、普通<code>for</code>循环语句实现相同的功能：将从后台获取的用户头像<code>url</code>转换成头像<code>widget</code>显示在界面上(最多显示4个，同时过滤掉无效<code>url</code>)。</p>
<p><img src="/img/stackusericon.jpeg" alt=""></p>
<p>再看个例子，进一步感受一下两者的差异：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// imperative JavaScript</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">var</span> excellentStudentEmails_I = <span class="function"><span class="keyword">function</span>(<span class="params">students</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> emails = [];</span><br><span class="line">  students.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item, index, array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (item.score &gt;= <span class="number">90</span>) &#123;</span><br><span class="line">      emails.push(item.email);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">	</span><br><span class="line">  <span class="keyword">return</span> emails;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// functional JavaScript</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">var</span> excellentStudentEmails_F = <span class="function"><span class="params">students</span> =&gt;</span></span><br><span class="line">  students</span><br><span class="line">    .filter(<span class="function"><span class="params">_</span> =&gt;</span> _.score &gt;= <span class="number">90</span>)</span><br><span class="line">    .map(<span class="function"><span class="params">_</span> =&gt;</span> _.email);</span><br></pre></td></tr></table></figure>
<p>上面这两段代码都是获取成绩&gt;=90分学生的 email。</p>
<p>很明显，函数式实现的代码简洁、易读、逻辑清晰、不易出错<br><code>for</code>循环版本需要很小心地维护实现上的细节问题，还引入了不必要的中间状态：<code>count</code>、<code>url</code>、<code>memberWidget</code>、<code>emails</code>等，这些都是滋生 bug 的温床！</p>
<p>好了，说到减少中间状态就不得不提 Pointfree。</p>
<h1 id="Pointfree"><a href="#Pointfree" class="headerlink" title="Pointfree"></a>Pointfree</h1><hr>
<p>仔细分析上节获取成绩&gt;=90分学生 email 的函数式版本，发现整个过程其实可以分为2个独立的步骤：</p>
<ul>
<li>过滤出成绩&gt;=90分的学生；</li>
<li>取学生的 email。</li>
</ul>
<p>将这两个步骤独立成2个小函数：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">excellentStudents</span>(<span class="params">students</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> students</span><br><span class="line">    .filter(<span class="function"><span class="params">_</span> =&gt;</span> _.score &gt;= <span class="number">90</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">emails</span>(<span class="params">students</span>) </span>&#123;</span><br><span class="line">  students</span><br><span class="line">    .map(<span class="function"><span class="params">_</span> =&gt;</span> _.email);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这时<code>excellentStudentEmails</code>就可以写成下面这样了：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> excellentStudentEmails_N = </span><br><span class="line">  students =&gt; emails(excellentStudents(students));</span><br></pre></td></tr></table></figure></p>
<p>这种嵌套调用的写法好像看不出有什么优势。<br>但有一点可以明确：一个函数的输出(<code>excellentStudents</code>)直接成为另一个函数的输入(<code>emails</code>)。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> compose = <span class="function">(<span class="params">f, g</span>) =&gt;</span> x =&gt; f(g(x));</span><br></pre></td></tr></table></figure>
<p>我们引入另外一个函数：<code>compose</code>，其入参为两个单参数函数(<code>f</code>、<code>g</code>)，输出还是一个单参数函数(<code>x =&gt; f(g(x))</code>)。<br>通过<code>compose</code>来改写<code>excellentStudentEmails</code>：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> excellentStudentEmails_C = compose(emails, excellentStudents);</span><br></pre></td></tr></table></figure></p>
<p>相比嵌套调用版本<code>excellentStudentEmails_N</code>，组合版本<code>excellentStudentEmails_C</code>具有以下两点优势：</p>
<ul>
<li>可读性更好，从右往左而不是由内而外的阅读顺序更符合我们的思维习惯；</li>
<li><code>excellentStudentEmails_C</code>版本自始至终从未提及要操作的数据，减少了中间状态信息(状态越多越容易出错)。</li>
</ul>
<p>没有中间状态，没有参数，数据直接在组合的函数间流动，这也是 Pointfree 最直接的定义。<br>从本质上说，Pointfree 就是通过一系列『通用函数的组合』来完成更复杂的任务，其设计理念：</p>
<ul>
<li>鼓励写高内聚、可复用的『小』函数；</li>
<li>强调『组合』，而非『耦合』，复杂任务通过小任务组合完成，而不是将所有操作耦合在一个『大』函数里。</li>
</ul>
<p>组合后的函数就像是用管道连接的一样，数据在其中自由流动，无须外界干预：</p>
<p><img src="/img/pipe.png" alt=""></p>
<blockquote>
<p>在 UNIX shell 命令中有专门的管道命令 ‘|’，如：ls | grep Podfile，组合了 ls 与 grep 命令，用于判断当前目录下是否有 Podfile 文件。</p>
</blockquote>
<blockquote>
<p>注意，对于<code>excellentStudentEmails</code>来说，<code>excellentStudentEmails_F</code>版本是更好的写法，<code>excellentStudentEmails_C</code>只是用于解说 Pointfree 的概念。</p>
</blockquote>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><hr>
<p>我们不奢望，也没办法做到纯函数式的编程，但函数式编程中很多优秀的设计理念都值得我们去学习和借鉴：</p>
<ul>
<li>状态不可变，避免过多的中间状态；</li>
<li>纯函数；</li>
<li>高内聚的小函数；</li>
<li>多用组合；</li>
<li>做好抽象，屏蔽细节；</li>
<li>…</li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://legacy.gitbook.com/book/llh911001/mostly-adequate-guide-chinese/details" target="_blank" rel="noopener">JS 函数式编程指南</a><br><a href="https://book.douban.com/subject/26587213/" target="_blank" rel="noopener">函数式编程思维</a><br><a href="https://www.zhihu.com/question/28292740" target="_blank" rel="noopener">什么是函数式编程思维</a><br><a href="https://martinfowler.com/articles/collection-pipeline/" target="_blank" rel="noopener">Collection Pipeline</a><br><a href="https://github.com/getify/Functional-Light-JS" target="_blank" rel="noopener">Functional-Light JavaScript</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/架构/" rel="tag"># 架构</a>
          
            <a href="/tags/设计/" rel="tag"># 设计</a>
          
            <a href="/tags/函数式/" rel="tag"># 函数式</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/12/22/Efficient-Development-Solutions/" rel="next" title="iOS 高效开发解决方案">
                <i class="fa fa-chevron-left"></i> iOS 高效开发解决方案
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="gitalk-container"></div>
  
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/img/author.jpg" alt="赵雪峰">
          <p class="site-author-name" itemprop="name">赵雪峰</p>
           
              <p class="site-description motion-element" itemprop="description">记录技术点滴</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">42</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">20</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zxfcumtcs" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="zxfcumtcs@gmail.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                      E-Mail
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Overview"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Functional-vs-Imperative"><span class="nav-number">2.</span> <span class="nav-text">Functional vs. Imperative</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#现状"><span class="nav-number">2.1.</span> <span class="nav-text">现状</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#纯函数"><span class="nav-number">3.</span> <span class="nav-text">纯函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#相同的输入，相同的输出"><span class="nav-number">3.1.</span> <span class="nav-text">相同的输入，相同的输出</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#无副作用"><span class="nav-number">3.2.</span> <span class="nav-text">无副作用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#高阶函数-Higher-order-function"><span class="nav-number">4.</span> <span class="nav-text">高阶函数(Higher-order function)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#柯里化-Currying"><span class="nav-number">5.</span> <span class="nav-text">柯里化(Currying)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#集合操作三板斧"><span class="nav-number">6.</span> <span class="nav-text">集合操作三板斧</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#过滤-filter"><span class="nav-number">6.1.</span> <span class="nav-text">过滤(filter)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#映射-map"><span class="nav-number">6.2.</span> <span class="nav-text">映射(map)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#折叠-化约-reduce、fold"><span class="nav-number">6.3.</span> <span class="nav-text">折叠/化约(reduce、fold)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pointfree"><span class="nav-number">7.</span> <span class="nav-text">Pointfree</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#小结"><span class="nav-number">8.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考资料"><span class="nav-number">9.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">赵雪峰</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: 'aec121637fcf733c4299',
          clientSecret: '551b5a3eb4e49773816880f1a6c4ffd8c8893464',
          repo: 'zxfcumtcs.github.io',
          owner: 'zxfcumtcs',
          admin: ['zxfcumtcs'],
          id: location.pathname,
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')           
       </script>



  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("bdhTYmQjzWTTLjKn66BIYj5E-gzGzoHsz", "6Lc7jOOONeLP6mUTb7x5NzVf");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
